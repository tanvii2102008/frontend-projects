<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personal Notes Vault</title>
<style>
    :root{
        --bg:#f3f5f9; --card:#fff; --muted:#6b7280; --accent:#3b82f6;
        --glass: rgba(255,255,255,0.6);
    }
    [data-theme="dark"]{
        --bg:#0b1020; --card:#0f1724; --muted:#9ca3af; --accent:#60a5fa;
        --glass: rgba(255,255,255,0.04);
    }

    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#e6eefc);transition:background .3s}
    .app{
        max-width:1100px;margin:28px auto;padding:20px;display:flex;flex-direction:column;gap:18px;
    }

    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
        width:44px;height:44px;border-radius:10px;background:conic-gradient(from 90deg,#ff9a9e,#fad0c4,#fbc2eb,#a6c1ee);box-shadow:0 6px 18px rgba(12,20,40,.12);
        display:grid;place-items:center;color:#fff;font-weight:700;font-size:18px
    }
    h1{font-size:18px;margin:0;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{
        background:var(--card);border:1px solid rgba(15,23,42,.04);padding:8px 12px;border-radius:10px;cursor:pointer;color:var(--muted);
        display:inline-flex;gap:8px;align-items:center;transition:transform .12s,box-shadow .12s;
    }
    .btn:active{transform:translateY(1px)}
    .search{
        display:flex;gap:8px;align-items:center;background:var(--card);padding:10px;border-radius:12px;flex:1;border:1px solid rgba(15,23,42,.04)
    }
    .search input{border:0;background:transparent;outline:none;font-size:14px;color:var(--muted);width:260px}
    .filters{display:flex;gap:8px;align-items:center}

    .new-note{display:flex;gap:8px;flex-direction:column;background:linear-gradient(180deg,var(--glass),transparent);padding:14px;border-radius:12px;border:1px solid rgba(15,23,42,.04)}
    .row{display:flex;gap:8px;align-items:center}
    input[type="text"],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(15,23,42,.04);background:transparent;color:inherit}
    textarea{min-height:80px;resize:vertical}

    .tags-input{display:flex;gap:6px;flex-wrap:wrap}
    .tag{background:linear-gradient(90deg,#fef3c7,#fde68a);padding:6px 8px;border-radius:999px;font-size:12px;color:#92400e}

    .notes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .note{
        position:relative;padding:14px;border-radius:12px;min-height:140px;color:#111;overflow:hidden;
        background:linear-gradient(135deg, #fff7ed, #fff1f2);
        box-shadow:0 6px 18px rgba(12,20,40,.06);transition:transform .18s,box-shadow .18s,opacity .2s;
    }
    .note:hover{transform:translateY(-6px);box-shadow:0 14px 40px rgba(12,20,40,.12)}
    .note .title{font-weight:700;margin-bottom:6px}
    .note .content{white-space:pre-wrap;color:#111;font-size:13px;opacity:.95}
    .note .meta{display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap}
    .note .tag-pill{background:rgba(0,0,0,.06);padding:6px 8px;border-radius:8px;font-size:12px;color:var(--muted)}
    .note .actions{position:absolute;right:8px;top:8px;display:flex;gap:6px}
    .icon{width:36px;height:36px;border-radius:8px;display:grid;place-items:center;cursor:pointer;background:rgba(255,255,255,.4);font-weight:600;color:var(--muted);border:1px solid rgba(15,23,42,.04)}

    .pinned-section{display:flex;flex-direction:column;gap:10px}
    .section-title{font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px}

    .note.pinned{outline:3px solid rgba(255,215,100,.12)}
    .fade-in{animation:pop .18s ease}
    @keyframes pop{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}

    .empty{padding:36px;border-radius:12px;border:1px dashed rgba(15,23,42,.06);text-align:center;color:var(--muted)}

    .toggle{display:inline-flex;align-items:center;gap:8px;padding:6px;border-radius:999px;border:1px solid rgba(15,23,42,.04);cursor:pointer}
    .small{font-size:13px}
    footer{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;padding-top:8px}
    .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,.04)}
</style>
</head>
<body data-theme="light">
<div class="app">
    <header>
        <div class="brand">
            <div class="logo">PN</div>
            <div>
                <h1>Personal Notes Vault</h1>
                <div class="small" style="color:var(--muted)">Create, pin, edit and save notes locally</div>
            </div>
        </div>

        <div class="controls" aria-hidden>
            <div class="search" role="search">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                <input id="search" placeholder="Search notes or tags..." />
                <div class="filters">
                    <select id="tagFilter" class="btn small">
                        <option value="">All tags</option>
                    </select>
                    <button id="clearAll" class="btn small">Clear all</button>
                </div>
            </div>

            <div style="display:flex;gap:8px;align-items:center;">
                <button id="toggleTheme" class="btn">Toggle theme</button>
            </div>
        </div>
    </header>

    <section class="new-note" aria-label="Create note">
        <div class="row" style="gap:12px">
            <input id="title" type="text" placeholder="Title (optional)"/>
            <input id="tags" type="text" placeholder="Tags (comma separated)" />
            <button id="addNote" class="btn">Add note</button>
        </div>
        <textarea id="content" placeholder="Write your note here... (supports new lines)"></textarea>
        <div class="row" style="justify-content:space-between">
            <div class="small" style="color:var(--muted)">Tip: Use tags to categorize. Pin important notes.</div>
            <div class="row">
                <button id="sample" class="btn small">Insert sample</button>
                <div id="autosave" class="small" style="opacity:.7">Saved locally</div>
            </div>
        </div>
    </section>

    <main>
        <div id="pinnedWrap" class="pinned-section"></div>
        <div id="notesWrap" class="notes-grid"></div>
        <div id="empty" class="empty" style="display:none">No notes yet. Create your first note above.</div>
    </main>

    <footer>
        <div class="small">Notes saved to localStorage</div>
        <div class="badge" id="count">0 notes</div>
    </footer>
</div>

<script>
    // Storage key & utilities
    const KEY = 'personal-notes-vault:v1';
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,8);

    // Elements
    const titleEl = qs('#title'), contentEl = qs('#content'), tagsEl = qs('#tags'), addBtn = qs('#addNote');
    const notesWrap = qs('#notesWrap'), pinnedWrap = qs('#pinnedWrap'), emptyEl = qs('#empty');
    const searchEl = qs('#search'), tagFilter = qs('#tagFilter'), countEl = qs('#count');
    const toggleThemeBtn = qs('#toggleTheme'), sampleBtn = qs('#sample'), clearAllBtn = qs('#clearAll'), autosaveEl = qs('#autosave');

    // State
    let NOTES = loadNotes();
    let filter = {q:'', tag:''};

    // Init
    render();
    populateTagFilter();
    setupEvents();
    updateCount();

    // Functions
    function loadNotes(){
        try{
            const raw = localStorage.getItem(KEY);
            if(!raw) {
                const starter = [];
                localStorage.setItem(KEY, JSON.stringify(starter));
                return starter;
            }
            return JSON.parse(raw);
        }catch(e){ return []; }
    }
    function saveNotes(){
        localStorage.setItem(KEY, JSON.stringify(NOTES));
        autosaveEl.textContent = 'Saved locally';
        updateCount();
    }

    function addNote(){
        const text = (contentEl.value || '').trim();
        if(!text && !titleEl.value.trim()) return flash(autosaveEl,'Enter a title or content');
        const note = {
            id: uid(), title: titleEl.value.trim(), content: text,
            tags: parseTags(tagsEl.value), pinned:false, created:Date.now(), updated:Date.now(),
            style: randomGradient()
        };
        NOTES.unshift(note);
        saveNotes();
        clearInput();
        render();
        populateTagFilter();
    }

    function parseTags(input){
        return input.split(',').map(t=>t.trim()).filter(Boolean).slice(0,5);
    }

    function randomGradient(){
        const gradients = [
            'linear-gradient(135deg,#ff9a9e,#fad0c4)',
            'linear-gradient(135deg,#fbc2eb,#a6c1ee)',
            'linear-gradient(135deg,#fef3c7,#fde68a)',
            'linear-gradient(135deg,#c7f9cc,#bfe9ff)',
            'linear-gradient(135deg,#ffe0f0,#f7d1a6)'
        ];
        return gradients[Math.floor(Math.random()*gradients.length)];
    }

    function render(){
        const pinned = NOTES.filter(n=>n.pinned);
        const rest = NOTES.filter(n=>!n.pinned);
        renderSection(pinnedWrap, pinned);
        const filtered = filterNotes(rest);
        renderGrid(filtered);
        emptyEl.style.display = (NOTES.length===0) ? 'block' : 'none';
    }

    function renderSection(container, items){
        container.innerHTML = '';
        if(!items.length) return;
        const title = document.createElement('div');
        title.className = 'section-title';
        title.textContent = 'Pinned';
        container.appendChild(title);
        const grid = document.createElement('div');
        grid.className = 'notes-grid';
        items.forEach(n => grid.appendChild(createNoteEl(n)));
        container.appendChild(grid);
    }

    function renderGrid(items){
        notesWrap.innerHTML = '';
        if(!items.length && NOTES.length>0){
            notesWrap.innerHTML = '<div class="empty">No notes match your search/filter.</div>';
            return;
        }
        items.forEach(n => notesWrap.appendChild(createNoteEl(n)));
    }

    function createNoteEl(n){
        const el = document.createElement('article');
        el.className = 'note fade-in' + (n.pinned ? ' pinned':'');
        el.style.background = n.style || randomGradient();
        el.dataset.id = n.id;
        el.innerHTML = `
            <div class="actions">
                <div class="icon" data-action="pin" title="${n.pinned ? 'Unpin' : 'Pin'}">üìå</div>
                <div class="icon" data-action="edit" title="Edit">‚úèÔ∏è</div>
                <div class="icon" data-action="delete" title="Delete">üóëÔ∏è</div>
            </div>
            <div class="title">${escapeHtml(n.title || '')}</div>
            <div class="content">${escapeHtml(n.content)}</div>
            <div class="meta">
                ${n.tags.map(t=>`<div class="tag-pill">${escapeHtml(t)}</div>`).join('')}
                <div style="flex:1"></div>
                <div style="font-size:12px;color:rgba(0,0,0,.6)">${timeAgo(n.updated)}</div>
            </div>
        `;
        el.querySelectorAll('[data-action]').forEach(btn => {
            btn.addEventListener('click', e => {
                const action = btn.dataset.action;
                if(action==='pin') togglePin(n.id);
                if(action==='delete') removeNote(n.id);
                if(action==='edit') openEditor(n);
            });
        });
        return el;
    }

    function filterNotes(list){
        const q = filter.q.toLowerCase().trim();
        const tag = filter.tag.trim().toLowerCase();
        return list.filter(n=>{
            if(tag && !n.tags.map(t=>t.toLowerCase()).includes(tag)) return false;
            if(!q) return true;
            return (n.title||'').toLowerCase().includes(q) || (n.content||'').toLowerCase().includes(q) || n.tags.join(' ').toLowerCase().includes(q);
        });
    }

    function togglePin(id){
        NOTES = NOTES.map(n => n.id===id ? {...n, pinned:!n.pinned, updated:Date.now()} : n);
        saveNotes(); render(); populateTagFilter();
    }

    function removeNote(id){
        if(!confirm('Delete this note?')) return;
        NOTES = NOTES.filter(n => n.id !== id);
        saveNotes(); render(); populateTagFilter();
    }

    function openEditor(n){
        // Simple inline editor modal
        const modal = document.createElement('div');
        Object.assign(modal.style, {
            position:'fixed',inset:0,display:'grid',placeItems:'center',background:'rgba(2,6,23,.45)',zIndex:9999
        });
        modal.innerHTML = `
            <div style="width:720px;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 20px 60px rgba(2,6,23,.6)">
                <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                    <input id="eTitle" style="flex:1" value="${escapeHtml(n.title||'')}" />
                    <input id="eTags" style="width:180px" value="${escapeHtml((n.tags||[]).join(', '))}" />
                    <button id="eSave" class="btn small">Save</button>
                    <button id="eCancel" class="btn small">Close</button>
                </div>
                <textarea id="eContent" style="width:100%;height:240px;border-radius:8px;border:1px solid rgba(15,23,42,.04)">${escapeHtml(n.content||'')}</textarea>
            </div>
        `;
        document.body.appendChild(modal);
        modal.querySelector('#eCancel').onclick = () => modal.remove();
        modal.querySelector('#eSave').onclick = () => {
            const t = modal.querySelector('#eTitle').value.trim();
            const c = modal.querySelector('#eContent').value.trim();
            const tg = parseTags(modal.querySelector('#eTags').value);
            NOTES = NOTES.map(x => x.id===n.id ? {...x, title:t, content:c, tags:tg, updated:Date.now()} : x);
            saveNotes(); render(); populateTagFilter();
            modal.remove();
        };
    }

    function openSample(){
        titleEl.value = 'Meeting notes';
        tagsEl.value = 'work,meeting';
        contentEl.value = 'Discuss roadmap:\n- Q1 goals\n- Technical debt\n- Next steps';
    }

    function clearInput(){ titleEl.value=''; contentEl.value=''; tagsEl.value=''; }

    function populateTagFilter(){
        const tags = Array.from(new Set(NOTES.flatMap(n => n.tags || []))).sort();
        tagFilter.innerHTML = '<option value="">All tags</option>' + tags.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');
    }

    function setupEvents(){
        addBtn.addEventListener('click', addNote);
        sampleBtn.addEventListener('click', openSample);
        clearAllBtn.addEventListener('click', () => { if(confirm('Clear all notes?')){ NOTES=[]; saveNotes(); render(); populateTagFilter(); }});
        searchEl.addEventListener('input', e => { filter.q = e.target.value; render(); });
        tagFilter.addEventListener('change', e => { filter.tag = e.target.value; render(); });
        toggleThemeBtn.addEventListener('click', () => {
            const root = document.body;
            root.dataset.theme = root.dataset.theme === 'dark' ? 'light' : 'dark';
        });

        // keyboard shortcuts
        document.addEventListener('keydown', e => {
            if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='b'){ e.preventDefault(); toggleThemeBtn.click(); }
            if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='n'){ e.preventDefault(); titleEl.focus(); }
        });
    }

    function removeAll() { NOTES=[]; saveNotes(); render(); populateTagFilter(); }

    function updateCount(){ countEl.textContent = `${NOTES.length} note${NOTES.length===1?'':'s'}`; }

    function timeAgo(ts){
        if(!ts) return '';
        const s = Math.floor((Date.now()-ts)/1000);
        if(s < 60) return `${s}s`;
        if(s < 3600) return `${Math.floor(s/60)}m`;
        if(s < 86400) return `${Math.floor(s/3600)}h`;
        return `${Math.floor(s/86400)}d`;
    }

    function escapeHtml(str){
        return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);
    }

    function flash(el, msg){
        const old = el.textContent;
        el.textContent = msg;
        setTimeout(()=>el.textContent = old, 1500);
    }

    // Auto-save hint behavior: if typing, show "Editing..." then "Saved locally" after 1.2s
    let timer;
    [titleEl,contentEl,tagsEl].forEach(inp=>{
        inp.addEventListener('input', ()=> {
            autosaveEl.textContent = 'Editing...';
            clearTimeout(timer);
            timer = setTimeout(()=>{ autosaveEl.textContent = 'Draft in memory (click Add)'; }, 1200);
        });
    });

    // Initialize demo if no notes
    if(NOTES.length===0){
        NOTES = [
            {id:uid(), title:'Welcome', content:'This is your Personal Notes Vault.\n- Create notes with tags\n- Pin important ones\n- Search and filter', tags:['intro'], pinned:true, created:Date.now(), updated:Date.now(), style:randomGradient()},
            {id:uid(), title:'Ideas', content:'Gradient sticky note cards\nCategory tags\nSearch + filter\nLight/dark mode', tags:['ideas'], pinned:false, created:Date.now(), updated:Date.now(), style:randomGradient()}
        ];
        saveNotes();
        render();
        populateTagFilter();
    }

</script>
</body>
</html>